# 7.6.1 -> 7.8.0.0 upgrade

## Get and analyze release notes

### Feature Enhancements
Feature enhancements in release 7.6.1.0 include the following:


- **[OAuth 2 support for Google connector](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.6/Ult/Administration_Guide/System/#Setting_Connector_Properties "OAuth 2 authentication for Google connector")** OAuth 2 authentication is now supported for Google connector.
- **[Collapse all subpanels option](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.6/Ult/Administration_Guide/System/#User_Interface "Collapse all subpanels option")** : Administrators now have the option to collapse all subpanels in Sidecar modules by default via Admin > System Settings.
- **List View performance improvements** : Experience faster load times when viewing and filtering Sidecar module list views.
- **Process Author enhanced user variables** : Process definition criteria can now be filtered by whether or not the record owner was the user who created or last modified the record.
- **Process Author timed elements** : Wait events in process definitions can now be configured relative to a record's date created and/or date modified.

Feature enhancements in release 7.7.0.0 include the following. To view new features added for versions 7.5.0.0 through 7.6.0.0, please refer to the [Sugar 7.6.0.0 Release Notes](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.6/Ult/Sugar_7.6.0.0_Release_Notes/ "Sugar Ultimate 7.6.0.0 Release Notes").


- **[Improvements to Global Search](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Search/#Global_Search "Search")** : Improvements have been made to the Global Search user interface and functionality (e.g. search tags, etc.).
- **[Knowledge Base user interface](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Knowledge_Base/ "Knowledge Base")** : The Knowledge Base module now uses the Sidecar user interface.
- **[Tag Management](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Administration_Guide/Tag_Management "Tag Management")** : Users with administrator or developer access can utilize the Tags module to manage the system-wide tag repository.
- **[Tagging](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Tags/#Working_With_Tags "Tags")**  : Sidecar modules contain a Tags field where users can create and share tags which can be used to identify records in filters, dashlets, and reports.
- **[Additional lead conversion options](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Leads/#Steps_to_Convert_a_Lead "Leads")**  : Leads can now be converted by clicking the Unconverted button in the Leads record view, as well as by selecting the Convert option from the Leads subpanel actions menu.
- [**Automatically associate module during lead conversion**](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Leads/#Steps_to_Convert_a_Lead) : Records will now be automatically associated during lead conversion if no duplicate records are found.
- [**Lead Conversion Options setting**](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Administration_Guide/System/#User_Interface "System"): The Lead Conversion Options setting is now available in Admin > System Settings to handle activity records during lead conversion.
- **[Collapse all subpanels option](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Administration_Guide/System/#User_Interface "System")** : Administrators now have the option to collapse all subpanels in Sidecar modules by default via Admin > System Settings.
- **Configuring team sets in process definitions** : Administrators can now append and replace teams via Change Fields and Add Related Record actions.
- **[Link to records in process emails](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Administration_Guide/Process_Author/Process_Email_Templates/#Using_the_Related_Link_Selector_Tool)** : Related record URLs may now be embedded in process email templates.
- **Configuring team sets in workflows**  : Administrators can now differentiate between a record's primary team and its current team set in workflows.
- **[Contact Type filter criteria added to D&B Build a List](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Contacts/#People_Filter_Panel "Contacts")** : The Contact Type field is now available as a filter criteria in the D&B People panel.
- **[D&B Usage Meter dashlet](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/User_Interface/Intelligence_Pane#DB_Usage_Meter "Intelligence Pane")** : The D&B Usage Meter dashlet is now available to view a summary of used and remaining credit information for each available metered service (e.g. Accounts, Family Tree, etc.).
- **[GU DUNS filter criteria added to D&B Build a List](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Accounts/#Company_Information_Filter_Panel "Accounts")**  : The GU DUNS field is now available as a filter criteria in the D&B Company Information panel.
- **Expanded list views preserved** : Filtered list views with "More records..." loaded remain expanded after in-line edits are saved.
- **Group reports by week** : Summation Report, Summation Report with Details, and Matrix Report can now be grouped by "Week" for Date and Datetime fields (e.g. Start Date, Date Created, etc.).
- **Intelligent subpanel filters for Cases module**  : When linking records via the Contacts subpanel in the Cases record view, the Search and Add Contacts drawer will automatically be filtered to only display contact records associated to the case's parent account.
- **[Move recipients across To, CC, and BCC fields](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Emails/#Composing_Emails "Emails")** : Recipients can now be dragged and dropped across the To, CC, and BCC fields in the Compose Email window for Sidecar modules.
- **Move To BCC option** : The Move To BCC option is now available when composing emails in the Emails module.
- **[Notification count in favicon](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/User_Interface/#Notifications "User Interface")** : The favicon (SugarCRM cube icon) in the browser tab now displays the same number corresponding to the count in the notifications box.
- **Quotes Bill To and Ship To subpanels** : The Quotes (Bill To) and Quotes (Ship To) subpanels are now available in the Accounts and Contacts record views in order to display the related quote records accordingly.
- **Search filter support for multiple Assigned to users**  : Multiple users can now be selected when creating search filters using the Assigned to field in Sidecar modules.
- **[Timestamp for forecast's commit history](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Forecasts/#Summary_and_Commit_History)** : The Forecast module's commit history now displays a timestamp.
- **[Total record count](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/User_Interface/#Total_Record_Count "User Interface")** : The total count of records are now available in Module list views, Subpanel list views, as well as Search and Select list views.
- **Tracker support for Sidecar modules** : Tracker sessions are now logged for Sidecar modules.
- **[Traditional Chinese language supported](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Application_Guide/Getting_Started#Setting_Your_Language "Getting Started")** : Users may now choose the traditional Chinese language as their preferred language in Sugar.
- **User selection list sort order** : User selection lists previously sorted by username are now sorted by last name, first name.
- **PHPMailer** : PHPMailer is now being installed by composer and upgraded to version 5.2.9.
- **Record view performance improvement** : Improvements have been made to load record view layouts faster when multiple dropdown fields and values exist in the layout.
- **[Additional option for SAML authentication](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Administration_Guide/Password_Management#SAML "Password Management")** : The "Load login screen in same window to avoid pop-up blocking" option can now be enabled via Admin > Password Management to load the SAML login screen in the current window and prevent pop-up blockers from disallowing single sign-on.
- **SimpleSAMLphp library 2.6.1 supported**  : SimpleSAMLphp library 2.6.1 is now supported in Sugar.
- **[Knowledge Base Categories & Published Articles dashlet on Knowledge Base list view in portal](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Portal_User_Guide/#Knowledge_Base_List_View)** : The Knowledge Base Categories & Published Articles dashlet is now available on the Knowledge Base list view in the portal.
- **Sugar logic support for portal** : Sugar logic is now supported in the portal.
- **[Upgrade support on all database stacks](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.7/Ult/Installation_and_Upgrade_Guide/#Upgrade_Prerequisites "Sugar 7.7 Installation and Upgrade Guide")** : Upgrades are now supported on all database stacks (MySQL, DB2, Oracle, MSSQL).

Feature enhancements in release 7.7.1.0 include the following:


- **[PHP 5.6 Support](http://support.sugarcrm.com/Resources/Supported_Platforms/Sugar_7.7.x_Supported_Platforms/)**  : PHP version 5.6 is now supported in Sugar.

The following feature enhancements are included in the 7.8.0.0 release:


- **[Team-based Permissions](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Application_Guide/User_Interface/#Using_Team-Based_Permissions)** : When enabled by administrators, users can leverage a record's Teams field to grant viewing, editing, etc. permissions to users with specific role configurations.
- **Additional recurrence types** : Calls and meetings now have expanded types of recurrence available, especially concerning monthly recurrences.
- **[Invitee missing email address indicator](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Application_Guide/Calls/#Call_Invitees)**  : Users will now be alerted of call and meeting invitees who will not receive email invites due to empty or invalid email addresses in Sugar.
- **Start Date color coding in Calls, Meetings, Tasks subpanels** : The start dates in the Calls, Meetings, and Tasks subpanels are now highlighted according to when their start date occurs.
- **[Sugar Process Author renamed to Advanced Workflow](http://support.sugarcrm.com/Knowledge_Base/Installation_Upgrade/What_to_Expect_When_Upgrading_to_7.8/#Process_Author_is_Now_Advanced_Workflow)** : Sugar's business process management tool, Process Author, is now called "Advanced Workflow".
- **Role access control for Processes module**  : Administrators now have the ability to disable the Processes module via Administration > Role Management.
- **[Improvements to locked fields in Advanced Workflow](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Administration_Guide/Advanced_Workflow/Process_Definitions/#Locked_Fields "Process Definitions")**  : For records involved in running processes, locked fields are now clearly marked with a lock icon in record view, and alerts have been added to enforce locked fields in list view and import.
- **Simplified rule selection in the process definition designer** : The Settings pop-up for business rule action elements now uses a dropdown list with type-ahead functionality.
- **Email address validation in Compose Email window** : Email addresses are now validated when composing emails from Sidecar modules (e.g. via Emails subpanel in Accounts module) in order to detect any invalid emails.
- **[Refresh option for list views and subpanels](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Application_Guide/User_Interface/#Refreshing_Search_Results)**  : Users now have the ability to refresh the records displayed in list views and subpanels by clicking the Refresh button to the right of the search bar.
- **Quantities of zero** : Revenue Line Items, Quoted Line Items, and Product Catalog records can now have quantities of zero and allow for manual entry of fields typically calculated based on a non-zero quantity.
- **[View Change Log option in Tasks module](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Application_Guide/Tasks/#Record_View_Actions_Menu)** : Users can now view a history of changes to audited fields for task records.
- **Command key supported for keyboard shortcuts** : The shortcut key now supports the use of "Command" for Macs.
- **[Customizable shortcut keys](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Application_Guide/User_Interface/Accessibility/#Customizing_Shortcut_Keys "Accessibility")** : Users can now customize the key combinations which trigger Sugar's shortcuts via the Keyboard Shortcuts page.
- **Dependent fields respected in list view's intelligence pane** : Dependent field formulas controlling a field's visibility are now respected when previewing records via the list view's intelligence pane.
- **T otal for grouped data in report chart dashlets** : Bar charts can now display the total for grouped data in report chart dashlets.
- **UTF-8 non-English characters supported for email address**  : Email addresses containing UTF-8 non-English characters may now be saved.

### Development changes
Changes in release 7.6.1.0 which may affect developers include the following:


- CSRF tokens for form submissions are now supported.
- The Duration field in the Calls and Meetings modules has been changed to a select-list field.

Developer-level feature enhancements in release 7.6.2.1 include the following:


- **Language file hierarchy** : The order that language strings are loaded from the file system has changed. See the [Sugar Developer Guide](http://support.sugarcrm.com/Documentation/Sugar_Developer/Sugar_Developer_Guide_7.6/Language_Framework/Application_Labels_and_Lists) for more details on the updates language file hierarchy.

Changes in release 7.7.0.0 which may affect developers include the following:


- SSL connections are now supported for connecting to MySQL databases.
- A new lead's Status field is no longer hard coded to "New" in the bean's `save()` method. The default status value for new leads can now be controlled using metadata as in other dropdown fields.
- The previously deprecated `DBHelper` class has been removed in Sugar 7.7. Developers should rely on the `DBManager` class instead.
- The `side-pane` layout has been removed from default layout metadata used throughout the application. The `side-pane` layout was not used in the Sugar application and was therefore superfluous. This change does not affect the `dashboard-pane` or the `preview-pane` layouts.
- The deprecated `timeago` Handlebars helper has been removed. This helper has been deprecated since Sugar 7.2.0. Developers should use the `relativeTime` Handlebars helper instead.
- A new currency `SugarObject` implementation has been introduced that can be used in Vardefs. This makes it easier to add consistent currency field support to any Sugar module. To use it, add the `currencyimplementation` into the `VardefManager::createVardefcall` within a module's Vardefs as shown below:


  ```
  VardefManager::createVardef(
      'Opportunities',
      'Opportunity',
      array(
          'default',
          'assignable',
          'team_security',
          'currency'
      )
  );
  ```
- The Sidecar bean `getSyncedAttributes()` function has been deprecated and will be removed in a future release. Developers should instead use `getSynced()` which has a different signature and allows you to check for specific attributes or retrieve them all.
- Significant changes have been made to the Lead Convert panel in order to support automatically associating modules during lead conversion and to allow related activities to be moved. Existing customizations to the Lead Convert panel may not work after upgrade. Developers should verify that any existing customizations to the following Sidecar components work in a sandbox prior to upgrading: `convert-main`, `convert-panel`, `convert-headerpane`, `convert-options`, and `convert-panel-header`.
- Global Search has been changed to use a new view containing new code. Developers who have customized the previous view will need to manually migrate their changes.
- The "Rebuild Minified JS Files", "Rebuild JS Compressed Files", and "Repair JS Files"options have been removed from Admin > Repair. These actions can be triggered manually if necessary. See [this post](http://developer.sugarcrm.com/2016/04/04/handling-of-javascript-files-in-sugar-7-7/) for more details.
- The Duration fields in the Calls and Meetings modules have been changed to Integer fields.
- The `getSyncedAttributes()` has been deprecated and will be removed in a future release. Developers should instead use `getSynced()` which has a different signature and allows you to check for specific attributes or retrieve them all.
- The following config parameters have been added to support application-level caching in the database: `external_cache_force_backend`, `cache_expire_timeout`, `external_cache_db_gc_probability`, and `external_cache_disabled_db`.
- The config parameter `SAML_provisionUser` has been added to define whether non-existing users should be auto-provisioned in Sugar when logging in via SAML.
- CSRF tokens for form submissions are now supported.
- API requests will not return records in excess of the "Listview items per page" setting in Admin > System Settings which is known in the config file as `list_max_entries_per_page`.
- A new API endpoint `/globalsearch` has been added. For compatibility, the older `/search` API is still available.
- The following entrypoints have been added to the REST API:
  - `GET /rest/v10/Administration/search/status`
  - `GET /rest/v10/Administration/search/fields`
  - `POST /rest/v10/Administration/search/reindex`
  - `GET /rest/v10/Administration/elasticsearch/mapping`
  - `GET /rest/v10/Administration/elasticsearch/indices`
  - `GET /rest/v10/Administration/elasticsearch/routing`
  - `GET /rest/v10/Administration/elasticsearch/queue`
- The Relationships module has been deprecated. Developers should now be using `SugarRelationshipFactory` to manage bean relationships. The Relationships table has been removed because it was superfluous.
- Additional password hashing methods have been added and can be configured using `$sugar_config`.
- A change has been made to Sugar's API to no longer JSON encode database-stored settings except for arrays. This may affect custom PHP code which reads administrative config settings which were previously unnecessarily JSON encoded. Values which appear to be JSON encoded (i.e. begin with `{, [, "`) will now be JSON decoded.
- The `usePreparedStatements` config flag has been deprecated. The use of prepared statements will be implemented and enforced in a future release.
- The help page documentation for the `MassDelete` API cal has been corrected.
- Sidecar modules now support the `AssignToUserAction` Sugar Logic action.
- Developers who have created custom Sugar field types should obey a new `ellipsis_inline` setting used in Sugar Field metadata to ensure the field displays properly in different views. This can be tested by adding your custom field type to a Global search (where `ellipsis_inline` is false) or List views (where `ellipsis_inline` is true).
- The `partial` Handlebars helper now requires mandatory `component` and `context` values. The signature is now `partial 'name' component object custom=options` where `'name'` is the name of the partial template (unchanged), `component` is the component used (e.g. layout, field, or view), `object` is the context, and `custom=options` are the hashed options (unchanged).
- The jQuery UI library has been upgraded to version 1.11. Developers should re-test any custom code that makes direct use of jQuery UI APIs to ensure there are no unanticipated changes in behavior.
- The `app.utils.addNumberSeperators` API has been deprecated and will be removed in 7.9. It is replaced by `app.utils.addNumberSeparators` which has the same functionality and signature.
- The behavior of the `SugarAnalytics` API has been altered to improve performance. Existing customizations that use Analytics API functions may need to be updated.
- The `currentModule` property in the config-drawer layout `ConfigDrawerLayout` has been deprecated. The `this.module` property should be used instead.
- Customizable filter operators are now available on a per-module basis using metadata. For an example, see `modules/KBContents/clients/base/filters/operators/operators.php`.
- Sidecar's `View.Views.Base.PasswordmodalView` has been deprecated and will be removed in a future release. Developers should ensure they are not using or customizing this view which was only used in Sugar Portal.
- PHP 4 constructors have been deprecated in common `SugarBean` classes for Bugs, Cases, Contacts, etc. For example, use `Bug::__construct()` instead of `Bug::Bug()`
- Use of `CreateActionsLayout` and `CreateActionsView` (create-actions) has been deprecated in favor of `CreateLayout` and `CreateView` (create). The Sugar upgrade wizard will make a best effort migration of deprecated `create-actions` customizations. Refer to [this post](http://developer.sugarcrm.com/2015/12/29/update-on-createactionsview-changes-in-sugar-7-7/) for more details.
- For Knowledge Base Categories module, new REST APIs were added for reading and manipulating KB category hierarchies.
- A new boolean configuration setting `SAML_provisionUser` has been added that allows administrators to control SAML user auto provisioning. This setting is enabled (i.e. set to "true") by default.
- The `Select2` library used within the Sugar user interface has been upgraded to version 3.5.2. `Select2` is used to display drop down fields, etc. Refer to the [Select2 page on GitHub](https://github.com/select2/select2/tree/3.5.2) for more information. Developers should re-test any custom code that makes direct use of `Select2` APIs to ensure there are no unanticipated changes in behavior.
- A new config setting `rest_response_etag_cache_age` has been added that allows you to control the max-age value for the Cache-Control response header on REST API endpoints that support HTTP caching.
- Cross Site Request Forgery (CSRF) authentication has been added and can be enabled using a config setting, though it will be required in future Sugar versions. Developers need to use CSRF tokens on HTML forms used in Sugar's legacy modules. Refer to [this post](http://developer.sugarcrm.com/2015/12/01/csrf-tokens-in-sugar-7-7/) for more details
- The `$_SESSION` object is no longer a standard PHP array but an object that implements the `ArrayAccess` interface. Because of this, developers should no longer use standard PHP array utility functions to access the `$_SESSION` object. Refer to [this post](http://developer.sugarcrm.com/2016/01/11/php-session-changes-in-sugar-7-7/) for more details.
- Sugar's Global Search framework now includes support for Elasticsearch Aggregations. Aggregation results based on Module, Assigned User, etc, can be returned by global search queries that include `xmod_args=true` parameter. Query results can also be filtered based on these aggregation buckets.
- As part of the new tagging feature, a new `tag` field type has been introduced as well as a `taggable` SugarObject template that can be used to add tagging support to Sugar modules.
- The Sugar REST v10 `POST <module>/filter/count` endpoint has been deprecated. The equivalent `GET <module>/filter/count` endpoint should be used instead.
- Developers can now register multiple HTTP verbs at once for a single REST endpoint. When registering REST API endpoints using `SugarApi::registerApiRest`, the `reqType` parameter now supports passing an array of HTTP verbs. Refer to the example below:

  ```
  public function registerApiRest() {
    return array(
      'ping' => array(
       'reqType' => array('GET', 'POST'),
        'path' => array('ping'),
        'pathVars' => array(''),
        'method' => 'ping',
        'shortHelp' => 'An example API only responds with pong',
        'longHelp' => 'include/api/help/ping_get_help.html',
      ),
    );
  }
  ```
- For Logic Hooks, it is now possible to use PHP namespaces to define your hook class. When a namespaced class is used, the `file_path` parameter should be left null. Refer to the example below:

  ```
  $hook_array['after_save'][] = array(
    1,
    'example logic hook',
    null,
    'Sugarcrm\\Sugarcrm
    MyClass',
    'myMethod'
  );
  ```

Changes in release 7.7.1.0 which may affect developers include the following:


- A Command Line Interface (CLI) tool, located at `bin/sugarcrm`, and associated CLI framework has been added to the Sugar application. This CLI framework is in Beta so there could be significant changes to it in upcoming Sugar releases. This framework allows you to register commands using a new application-level Console extension point or by registering them using Composer.
- With the introduction of a new input validation framework, two new Sugar Config settings have been added, `validation.soft_fail` and `validation.compat_mode`. These settings are `true` by default to ensure compatibility, but these defaults will change in a future Sugar release. For more information, please refer to the Developer Guide or this SugarCON [security breakout presentation](https://community.sugarcrm.com/docs/DOC-3471).
- The following PHP methods and classes have been deprecated in order to add future support for prepared statements:

  - `SugarVisibility::addVisibilityFrom()`, `SugarVisibility::addVisibilityWhere()`, and `SugarVisibility::addVisibilityFromQuery()` have been deprecated. Use `SugarQuery` and `SugarVisibility::addVisibilityQuery()` instead.
  - `BeanVisibility::addVisibilityFrom()`, `BeanVisibility::addVisibilityWhere()`, and `BeanVisibility::addVisibilityFromQuery()` have been deprecated. Use `SugarQuery` and `BeanVisibility::addVisibilityQuery()` instead.
  - `SugarQuery_Builder_Delete` has been deprecated. Use `SugarBean::mark_deleted()` instead.
  - `SugarQuery_Builder_Insert` and `SugarQuery_Builder_Update` have been deprecated. Use `SugarBean::save()` instead.
  - `SugarQuery_Builder_Literal` has been deprecated. There is not alternative because the class was never fully implemented.
  - `SugarQuery_Compiler` has been deprecated. Use `SugarQuery_Compiler_SQL` instead.
  - `SugarQuery::joinRaw()` has been deprecated. Use `SugarQuery::joinTable()` instead. You can specify aliases and join types using parameters that will allow you to continue to specify any custom join.
  - `SugarQuery::compileSql()` is deprecated. Use `SugarQuery::execute()` instead or use `$query->compile()->getSQL()` and `$query>compile()->getParameters()`. Executed SQL can also be viewed in sugarcrm.log by adjusting the Sugar log level to DEBUG or INFO.
  - The `$execute` parameter on `DBManager::insertParams()` is deprecated. In the future, `insertParams()` will always execute.
  - The `$execute` parameter on `DBManager::updateParams()` is deprecated. In the future, `updateParams()` will always execute.
  - The `$where` parameter on `SugarBean::update()` is deprecated. This parameter is not necessary.
  - `DBManager::delete()` is deprecated. Use `SugarBean::mark_deleted()` instead.
  - `DBManager::retrieve()` is deprecated. Use `SugarBean::retrieve()` instead.
  - `DBManager::insertSQL()` is deprecated. Use `DBManager::insert()` instead.
  - `DBManager::updateSQL()` is deprecated. Use `DBManager::update()` instead.
  - `DBManager::deleteSQL()` is deprecated. Use `SugarBean::mark_deleted()` instead.
  - `DBManager::retrieveSQL() is deprecated. Use `DBManager::retrieve()` instead.`
  - `DBManager::preparedQuery()`, `DBManager::pQuery()`, `DBManager::prepareQuery()`, `DBManager::prepareTypeData()`, and `DBManager::prepareStatement()` have been deprecated. These `DBManager` methods are no longer necessary.
- The `jssource` directory which contained copies of JavaScript sources has been removed from Sugar. Unminified JavaScript sources are available at their home locations such as under the `clients`, `include/javascript`, or `sidecar` directories. For more information, refer to this [Developer Blog post](https://developer.sugarcrm.com/2016/04/04/handling-of-javascript-files-in-sugar-7-7/).
- JSONP support for v4\_1 REST API and earlier versions is now disabled by default. A new config option `jsonp_web_service_enabled` should be set to `true` to enable JSONP support on these API versions.

Changes in release 7.7.2.0 which may affect developers include the following:


- The News dashlet has been disabled in this release since it relied on the Google News Search API which has been [deprecated since 2011](https://developers.google.com/news-search/ "Google News"). Any code that relied on this News dashlet or the Google News Search API will need to be updated to use an [alternative news API](https://en.wikipedia.org/wiki/List_of_news_media_APIs "List of News APIs").
- Some `PreviewLayout` metadata customizations that were non-functional in 7.7.0 have been corrected.
- Sidecar math functions will now return strings instead of numbers in order to improve the way Sidecar handles math and currency values. This will prevent floating point errors, specifically when dealing with currencies. The improved implementation relies on the `big.js` version 3.1.3 library that was introduced in this release.

The following changes in release 7.8.0.0 may affect developers:


- The `oracle_enable_ci` config setting has been removed because case insensitivity no longer impacts performance for instances on Oracle databases.
- The `['csrf']['soft_fail_form']` config secodeing now defaults to `false` and the `['csrf']['opt_in']` setting has been removed. This means that CSRF tokens are now enabled out-of-the-box. If necessary, developers can set `$sugar_config['csrf']['soft_fail_form'] = true;` in non-production instances to disable enforcement of CSRF tokens, but FATAL notices will be generated in the `sugarcrm.log` whenever a CSRF authentication failure happens. For more information, please refer to [this developer blog post](https://developer.sugarcrm.com/2015/12/01/csrf-tokens-in-sugar-7-7/).
- The new config setting `allow_oauth_via_get` can be set to true to permit an `oauth_token` URL parameter to be used to pass the access token to Sugar's v10 REST API. The default value is `false`. This setting is provided for compatibility reasons, but enabling it is not recommended due to security concerns with passing session identifiers as URL parameters.
- The new config setting `email_mailer_timeout` can be used to change how long Sugar will wait for confirmation from an SMTP server as the default value of 20 seconds may be insufficient depending on your email server's processes and needs.
- Sugar Developers now have the ability to extend existing and customize Advanced Workflow (PMSE) classes using the custom directory. New custom actions can also be defined for use in Advanced Workflow processes. Developers can load custom Advanced Workflow objects using the new `ProcessAuthor\Factory::getProcessAuthorObject(string)` API. For example, `$obj = ProcessAuthor\Factory::getProcessAuthorObject('PMSEBusinessRule');`
- Advanced Workflow locked fields have been completely refactored using the ACL architecture.
- For those Sugar Developers with access to Sugar Test Tools, Gulp is now used instead of Grunt for unit test automation. Refer to the [Gulp website](http://gulpjs.com/ "Gulp") for more information.
- The `DashboardHeaderpaneView` has been changed to extend from `HeaderpaneView` instead of from `RecordView`.
- JavaScript source maps have been introduced for Sidecar libraries. The Sidecar source map will be loaded automatically by browser developer tools to allow you an unminified look at sidecar.min.js. This replaces the need for sidecar.js to be shipped with the product. Source Maps support may need to be enabled in your browser. For example, this [Chrome Dev Tools](https://developers.google.com/web/tools/chrome-devtools/debug/readability/source-maps?hl=en#source-maps-in-devtools-sources-panel "Chrome Dev Tools") page provides guidance for doing so in Chrome. The Sidecar source map is located at `sidecar/minified/sidecar.min.js.map`.
- Empty Sidecar components `BaseLayout` and `BaseView` have been added which can be useful for Sugar Developers who want to override existing Sidecar Layouts and Views without inheriting from an existing implementation.
- Previously, the Preview components were initialized only when first rendering the page, which sometimes meant the Preview components were not properly initialized for the correct module when a record was previewed. The Preview components (such as the `PreviewView`) are now re-initialized and re-rendered whenever a preview icon is clicked to ensure it is properly initialized.
- The `oauth_token` URL parameter can should longer be used with Sugar v10 REST API due to security concerns with passing session identifiers as a URL parameter. This parameter is now disabled by default. Please use the `OAuth-Token` HTTP header to pass access tokens to Sugar v10 REST API.
- The default model class for Sidecar's `Data.BeanCollection` is now `Data.Bean` instead of `Backbone.Model`.
- The parent Sidecar controller used with a Sidecar component can be controlled using the `type` property in view metadata. A warning has been added when new Sidecar controllers are created that only extend from a different parent controller since using the `type` property is preferred and will reduce use of browser memory and increase performance.
- The Sugar user interface can now be embedded as an iframe within other websites.
- The Sugar `ModuleInstaller` class can now be customized using the custom directory and is located at `ModuleInstall/ModuleInstaller.php`.
- With the addition of new password hashing backends, legacy (MD5) password hashing is now disabled by default but can be enabled by using the `$sugar_config['passwordHash']['allowLegacy'] = true;` config setting. A utility for working with new Sugar password hashing methods is available on [Github](http://support.sugarcrm.com/Documentation/Sugar_Versions/7.8/Ult/Sugar_7.8.0.0_Release_Notes/%20https:/github.com/skymeyer/password_hash).
- Sugar installs will fail if an unsupported version of Elasticsearch is installed. Please review the [Supported Platforms](http://support.sugarcrm.com/Resources/Supported_Platforms/Sugar_7.8.x_Supported_Platforms/ "Sugar 7.8.x Supported Platforms") documentation for supported Elasticsearch versions.
- The following commands have been added to the `sugarcrm` command line interface:
  ```
  elastic:explain  Return search results with the "explain" details to show relevance score.
  password:config  Show password hash configuration.
  password:reset   Reset user password for local user authentication.
  password:weak    Show users having weak or non-compliant password hashes.
  ```
- The `SugarQuery` object by `FilterApi`class can now be extended by overriding the newly introduced `FilterApi#newSugarQuery()` static method. This makes it easy to inject custom `SugarQuery` objects into `FilterApi`subclasses.
- The Sidecar routes used with the Home module have been moved from `include/javascript/sugar7.js` to `modules/Home/clients/base/routes/routes.js`.
- There has been a change in the supported parameters for Sidecar's `Layout#loadData()` and `View#loadData()`. Previously, the optional `setFields` parameter could be used to change the fields set on the current context. This allowed a single component on the page to alter the behavior of other components on the page, which was unwise. Support for the `setFields` parameter has been removed. The method signature for Sidecar `loadData()` functions are now `loadData(options);`.
- A new boolean flag called `fetch` has been added to Sidecar `Context`. This flag can be used to control if the current `Context` will fetch data from the server. For example,
  ```
  var context = app.context.getContext({
      collection: new app.BeanCollection(),
      fetch: false,
  });

  ```When `fetch === false` then the `Context#loadData()`method will immediately return when called.
- The method signature for error callbacks for `Model#fetch`, `Model#destroy`, `Model#save`, and `Collection#fetch` has changed. The `Backbone.Model` or `Backbone.Collection` is passed as the first parameter and the second parameter is now the HttpError XHR object.
  Example using the previous method signature:
  ```
  >this.model.save({}, {
      error: function(error) {
          ...
      }
  });

  ```Example using the new signature:
  ```
  this.model.save({}, {
      error: function(model, error) {
          ...
   }
  });
  ```
- The Sidecar `app.metadata.getField()` API has been updated to allow access to module-specific field metadata. This additional behavior relies on new method signature with an `options` object. The existing method signature for `app.metadata.getField()` continues to work but is deprecated in this Sugar release. For example, to fetch the metadata for the Accounts module's description field you can use `app.metadata.getField({ module: 'Accounts', name: 'description' });`.
- Sugar Developers are advised in this and future Sugar releases to not modify the `this.meta` property in Sidecar controllers. Sidecar metadata should be defined in PHP and not modified at runtime by the JavaScript controller. Doing so can introduce errors.
- The function signature for `app.acl.hasAccess((action, module, ownerId, field, recordAcls)` has been refactored. It is now possible to pass an `options` object for the optional parameters ( `field` and `recordAcls`). The `ownerId` parameter was not previously used or supported since the current user was respected. Calling `app.acl.hasAccess()` using the old convention continues to work for compatibility reasons.
  Example using previous signature:
  `app.acl.hasAccess('edit', 'Accounts', null, 'industry', null);`Example using new signature:
  `app.acl.hasAccess('edit', 'Accounts', {field: 'industry'});`
- The default automatic close timeout when using Sidecar Alerts is now 5 seconds instead of 9 seconds. Sugar Developers can optionally provide a delay time in milliseconds to change the delay before closing. For example:
  ```
  // This Sidecar Alert message will automatically close after 10 seconds
  app.alert.show('message-id', {
      level: 'success',
      messages: 'Task completed!',
      autoClose: true
      autoCloseDelay : 10000
  });
  ```
- A boolean `lazy_loaded` metadata property is now supported in Sidecar Layouts. When set to `true`, the Layout components will not be initialized automatically when the Layout is initialized which prevents data from being loaded automatically. Sugar Developers can later manually initialize components by calling `this.initComponents(this._componentsMeta)` and fetch data when necessary.
- The SugarBean `update_date_modified` flag now behaves as expected for `before_save` logic hooks. Refer to the [SugarBean](http://support.sugarcrm.com/Documentation/Sugar_Developer/Sugar_Developer_Guide_7.8/Data_Framework/Models/SugarBean/ "SugarBean") documentation for more details.
- The structure of the Preview Layout metadata has changed as a result of performance improvements in the design. This means that custom Preview Layout metadata must set the `lazy_loaded` flag to `true`. For example,
  ```
  $viewdefs['base']['layout']['preview'] = array(
      'lazy_loaded' => 'true,
      'components' => array(
          ...
      ),
      ...
  )
  ```
- The Sugar record view (RecordView) was being rendered twice on each page load. This performance issue has been corrected. Now the record view renders once and the individual field components are re-rendered when data is available. Sugar Developers should test their record view customizations to ensure this does not introduce any regressions in code that relied on this behavior. Specifically, Developers should test any custom Sidecar code which relies on field data being available during record view render, since it will likely break as the views are rendered before fields.
- The following classes are now loaded using the `SugarAutoLoader::requireWithCustom()` API which allows overriding and extending the following Module Builder parser classes via the custom directory:
- `DashletMetaDataParser`
- `GridLayoutMetaDataParser`
- `ListLayoutMetaDataParser`
- `ParserDropDown`
- `ParserLabel`
- `ParserVisibility`
- `PopupMetaDataParser`
- `SearchViewMetaDataParser`
- `SidecarFilterLayoutMetaDataParser`
- `SidecarGridLayoutMetaDataParser`
- `SidecarListLayoutMetaDataParser`
- `SidecarPortalListLayoutMetaDataParser`
- `SidecarSubpanelLayoutMetaDataParser`
- `SubpanelMetaDataParser`

- The Sidecar Router has a new method called `app.router.get(name)`. It returns the callback function associated with the route `name`. This can be used, for example, to allow fallback behavior to an existing core Sidecar route, as demonstrated below:
  ```
          var routes = [
              {
                  name: 'myRouteCreate',
                  route: 'HelloWorld/create',
                  callback: function() {
                      // HelloWorld module specific logic for record creation
                      // ...
                      // then fallback to default create record route
                      app.router.get('create')('HelloWorld');
                  }
              },
              {
                  name:"myRoute",
                  route: "HelloWorld(/:my_custom_route)",
                  callback: myRoute
              },
              ...
          ];
  ```
- It is now possible for Sugar Developers to mark global Sidecar Events (events triggered on `app.events`) as deprecated. When registering a global event, you can specify an optional `deprecated` boolean parameter using an `options` object argument. This will trigger warnings in the JavaScript console whenever a listener subscribes using `app.events.on()`. For example,
  ```
  app.events.register('app:old_event:start', this, {deprecated: true});
  ...
  app.events.on('app:old_event:start', ...); // Throws deprecation warning
  ```
- The Filter metadata property called `filter_relate` should only be used to dynamically filter based upon a Relate field. All other field types should use the `filter_populate` property which allows filtering based upon pre-defined values. See the [Developer Guide](https://support.sugarcrm.com/Documentation/Sugar_Developer/Sugar_Developer_Guide_7.8/Architecture/Filters/ "Developer Guide") for full documentation on Filters. An example of the supported usage is shown below:
- ```
  //record to filter related fields by
  var contact = app.data.createBean('Contacts', {
      'first_name': 'John',
      'last_name': 'Smith',
      'assigned_user_id': 'seed_sally_id'
  });

  //create filter
  var filterOptions = new app.utils.FilterOptions()
      .config({
          'initial_filter': 'filterAccountTemplate',
          'initial_filter_label': 'LBL_FILTER_ACCOUNT_TEMPLATE',
          'filter_populate': {
              'account_type': ['Customer'],
          },
          'filter_relate': {
              'assigned_user_id': 'assigned_user_id'
          }
      })
      .populateRelate(contact)
      .format();

  //open drawer
  app.drawer.open({
      layout: 'selection-list',
      context: {
          module: 'Accounts',
          filterOptions: filterOptions,
          parent: this.context
      }
  });
  ```
- Sugar Developers can now provide the filter ID as part of a Filter API request rather than passing full filter definitions. This means a user's filters do not need to be fetched from server prior to being used. The Filter API will now throw a `SugarApiExceptionInvalidParameter` whenever a filter ID is improperly specified. For example, `<instance>/rest/v10/<module>/filter?filter_id=<filter id>` would execute a pre-existing filter with the given ID. Another example, `<instance>/rest/v10/<module>/filter?filter=<filter definition>&filter_id=<filter id>` would append additional filter criteria to a pre-existing filter.
- The Sidecar property `app.config.logLevel` has been deprecated and will be removed in a future release. Use `app.config.logger.level` instead.
- The SubpanelCreateLayout controller (`clients/base/layouts/subpanel-create`) has been deprecated. The SubpanelCreateLayout will use the SubpanelLayout controller instead of extending it.
- Sidecar's `Core.CacheManager#add` method has been deprecated and will be removed in a future release.
- The Sidecar `meta` property in views and layout definitions has been deprecated. This property allowed you to anonymously define Sidecar components within a Sidecar Layout. Sugar Developers should define Sidecar components within individual metadata files and reference them by name within Layout metadata. Sugar Developers that want to extend metadata for a particular component within a Sidecar Layout should use the `xmeta` property instead.
  For example, if you wanted to create a custom filterpanel that overrides the metadata defined in base filterpanel, then you could create a component like the following.
  ```
  $viewdefs['base']['layout']['custom-filterpanel'] = array(
      'components' => array(
          array(
              'layout' => 'filterpanel',
              'xmeta' => array(
                  'filter_options' => array(
                      'auto_apply' => false,
                      'stickiness' => false,
                      'show_actions' => false,
   ), ), ), ), );
  ```
- The `./clients/base/layouts/subpanels-create/subpanels-create` Sidecar layout has been deprecated and will be removed in a future release.
- The Sidecar Field controller's property `this.def`has been deprecated in this release. `this.def` is the combination of a field's definition from Vardefs (set of properties defining the field and its internal behavior) and the field's definition in Viewdefs (set of properties defining how the field will render from a view/UI standpoint) which caused problems when there were name collisions. Sugar Developers should rely on `this.viewDefs` and `this.fieldDef` when accessing metadata from Sidecar Field controllers.
- The jQuery `timepicker` plugin has been upgraded from version 1.4.10 to version 1.8.8. No changelog is available, so please use the [jQuery timepicker Github repository](https://github.com/jonthornton/jquery-timepicker/tree/1.8.8 "Follow link") to review API changes.
- The Tooltip plug-in has been deprecated and will be removed in a future release. There has been a change in behavior for how tooltips are attached to UI elements, resulting in a significant rendering performance improvement. Sugar Developers using custom tooltips on sidecar components will no longer need to use Tooltip plug-in. If the `rel=tooltip` attribute is in the Handlebars template, then tooltips will continue to work.
- The EllipsisInline plug-in has been deprecated and will be removed in a future release. Sugar Developers using the EllipsisInline plugin will no longer need to use this plug-in for their Sidecar components. If the ellipsis\_inline class is in component's Handlebars template, then ellipsis behavior will continue to work. Event bubbling is being used to implement these features rather than a DOM search, which significantly improves rendering performance. Developers should verify that the `ellipsis_inline` class and `rel=tooltip` attribute are not used where it is not needed to prevent ellipsis and tooltips from appearing.
- The Sidecar Field controller functions named `createErrorTooltips` and `destroyAllErrorTooltips`have been deprecated and will be removed in a future release.
- The `ErrorDecoration` Sidecar plug-in functions named `showTooltip` and `hideTooltip` have been deprecated and will be removed in a future release.
- The `app.utils.tooltip` JavaScript class has been deprecated and will be removed in a future Sugar release.
- The v10 REST `GET /<module>/filter/:record` endpoint has been deprecated in favor of the `GET /<module>/filter` endpoint and will be removed in future REST API versions. An equivalent call to `GET /<module>/filter/?` can be accomplished using `GET/<module>/filter?filter_id=?`.
- The deprecated `PasswordmodalView` has been removed for both portal and base platforms in this Sugar release. There is no replacement API because these views were rarely used. The views were located at `./clients/base/views/passwordmodal` and `./clients/portal/views/passwordmodal`.
- The unused and empty SugarMVC Notifications module controller has been removed. The file was located at `./modules/Notifications/controller.php`.
- The `AvatarField#_getModuleName()` method has been removed from AvatarField (`clients/base/fields/avatar/avatar.js`).
- The deprecated Sidecar method `app.lang.getModuleSingular` has been removed in this release. Sugar Developers should use `app.lang.getModuleName` instead.
- The Sidecar `NewsView` which was used for the News dashlet has been removed after previously being disabled and deprecated in Sugar 7.7.2.0. The `./clients/base/views/news/` directory was removed. Any remaining News dashlets appearing on user dashboards will be removed during upgrade.
- The code for an external job queue framework that was added in Sugar 7.7 has been removed including `queueManager.php` and `src/JobQueue/`. The 7.7 implementation of job queue will not be completed. The `cron.php` based job queue and scheduler continues to be supported.
- The deprecated boolean `visible` and string `access` parameters supported by Sidecar `app.metadata.getModuleNames()`method have been removed in this release. The `app.metadata.getModuleNames(options)` method now only accepts an `options` hash.
- The following elements were previously deprecated and have now been removed:
  JavaScript functions:
  - `Data.Bean.setDefaultAttributes`
  - `Data.Bean.setDefaultAttribute`
  - `Data.Bean.removeDefaultAttribute`
  - `Data.Bean.getDefaultAttribute`
  - `Data.Bean.getDefaultAttributes`
  - `App.File.checkFileFieldsAndProcessUpload`
  - `App.view.View.getTemplateFromMeta`
  - `App.view.fields.BaseParentField.checkAcl`
  - `App.view.layouts.BaseHeaderLayout.showMenu`
  - `App.view.layouts.BaseHeaderLayout.hideMenu`
  - `App.view.views.BaseBwcView.beforeRoute`

  Handlebars Helper functions:
  - `getFieldValue`

  JavaScript classes and associated files:
  - `App.view.layouts.CreateActionsLayout`
  - `App.view.views.BaseCreateActionsView`
  - `App.view.views.BaseRecordlistView.setScrollAtLeftBorder`
  - `App.view.views.BaseRecordlistView.setScrollAtRightBorder`

  JavaScript namespaces:
  - `App.file` (It is now hardcoded to an unmodifiable empty object)

  Sidecar utility functions:
  - `app.date.compareDates()` (use `app.util.compare()` instead)
  - `app.date.isDateAfter()` (use `app.util.isAfter()` instead)
  - `app.date.isDateBefore()` (use `app.util.isBefore()` instead)
  - `app.date.isDateOn()` (use `app.util.isSame()` instead)
  - `app.date.isDateBetween()` (use `app.util.isBetween()` instead)
- jQuery has been updated from version 1.7.1 to version 1.11.3. The jQuery Migrate 1.2.1 plug-in has been included to preserve compatibility for custom code using pre-1.9 jQuery APIs. The jQuery Migrate plug-in will be removed in a future release so Sugar Developers should start migrating code using pre-1.9 jQuery APIs to prevent future breakages. Refer to the JQuery Migrate Readme for more details. Refer to the [JQuery Migrate Readme](https://github.com/jquery/jquery-migrate#readme "JQuery Migrate Readme") for more details.
- The version of jQuery that is used within Legacy modules has been upgraded to version 1.11.1. BWC customizations that used jQuery APIs should be retested to verify they continue to work with this version of jQuery.
- The TinyMCE library has been upgraded from version 3.5.8 to version 4.1.8.
- The `Backbone.js` library has been upgraded from version 0.9.10 to version 1.2.3. Developers that have written code directly against Backbone.js APIs should test their customizations to ensure regressions have not occurred. There are, in some cases, a change in order of parameters used in some Backbone APIs. Usage of Sidecar provided APIs would be unaffected. Refer to the [Backbone documentation](https://cdn.rawgit.com/jashkenas/backbone/1.2.3/index.html "Follow link") for more details.
- The `Underscore.js` library has been upgraded from version 1.4.4 to version 1.8.3. Developers that have written code directly against Underscore APIs should test their customizations to ensure regressions have not occurred. There are, in some cases, a change in order of parameters used in some Underscore APIs. Usage of Sidecar-provided APIs are unaffected. An Underscore API change introduced in version 1.5.0 means that using `_.bindAll(object)` no longer works. You must specify the specific method names to bind using `_.bindAll(object, methodNames)`. Any custom Sugar code that relies on `_.bindAll(object)` needs to be updated. We recommend Sugar Developers use Underscore `_.bind()` or some other alternative to pass context to individual callback methods instead.

## Run health checker and fix all errors

Prior to attempting to upgrade to any 7.x release, Sugar recommends using the Health Check tool. The health check will notify you of any issues within your instance which will affect your ability to upgrade to your target version. For more information on running the health check, please refer to the Installation and Upgrade Guide specific to your version and edition of Sugar.

Download [health checker](url) and run it.

## Backup or rewrite core changes

If your build sources are GIT driven ("sugarcrm/Mango" fork) find all your core changes and (if possible) rewrite them in upgrade safe way. This way you'll avoid merge conflicts during the upgrade.
If it's not possible be sure to track and backup such changes. There is a big chance some of them:
- are implemented by core dev team in the version you plan to upgrade to
- make no sense anymore
- cause additional issues on its own (for example require missing file)
